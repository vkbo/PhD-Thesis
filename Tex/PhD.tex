%
%    PhD Thesis
% ~~~~~~~~~~~~~~~~~
%  Master Document
%

\documentclass[twoside,openright,12pt]{book}

% ================================================================================================================================ %

% Main Packages
%***************

% Main
\usepackage[utf8]{inputenc}
\usepackage[UKenglish]{babel}
\usepackage[T1]{fontenc}

% Math
\usepackage{nicefrac}
%\usepackage{xfrac}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}

% Bibliography
\usepackage[numbers,sort&compress]{natbib}
\bibliographystyle{PhD}                   % Custom citation style
\usepackage{doi}                          % Makes DOIs clickable

% Layout
\usepackage[a4paper]{geometry}            % Page geometry
\usepackage{emptypage}                    % Prevents page numbers on empty pages
\usepackage{setspace}                     % Line spacing
\usepackage{titlesec}                     % Alternative section titles
\usepackage{fancyhdr}                     % Changing headers and footers
\usepackage{tocloft}                      % For modifying the Table of Contents
\usepackage{appendix}                     % Added functionality for appendices
\usepackage{enumerate}                    % Allows for Roman numbered lists
\usepackage{float}                        % Floating of figures and tables

% Fonts
\usepackage[scaled]{raleway}              % Raleway font for sans-serif text
\usepackage[scaled]{sourcecodepro}        % Source Code Pro font for typewriter text
\usepackage{textcomp}                     % Adds additional text symbols
\usepackage{tgtermes}                     % TEX Gyre Termes font

% Content
\usepackage{pdfpages}                     % Include PDF files
\usepackage{datetime}                     % Used for the last page timestamp
\usepackage{todonotes}                    % Add Todo notes

% Tables
\usepackage{array}                        % Used for centred p elements
\usepackage{tabularx}                     % Allows full width tables
\usepackage{colortbl}                     % Allows table colouring
\usepackage{dcolumn}                      % Special decimal cells

% ================================================================================================================================ %

% Document Layout
%*****************

\geometry{twoside,left=25mm,right=25mm,top=30mm,bottom=30mm}
\AtBeginDocument{\parskip=0pt plus 2.5pt\relax\setstretch{1.1}}

% Fix section numbering bug in Titlesec
\usepackage{etoolbox}
\makeatletter
\patchcmd{\ttlh@hang}{\parindent\z@}{\parindent\z@\leavevmode}{}{}
\patchcmd{\ttlh@hang}{\noindent}{}{}{}
\makeatother

% Stretches text to fix underfull or overfull errors
\usepackage[activate=true,final,stretch=10,shrink=10]{microtype}

% Silence underfull errors for bibliography
\apptocmd{\sloppy}{\hbadness 10000\relax}{}{}

% Colours
\usepackage{color}
\definecolor{chapter} {gray}{0.60}
\definecolor{appendix}{gray}{0.50}
\definecolor{capcol}  {gray}{0.25}
\definecolor{tblhead} {rgb}{0.929,0.792,0.467}
\definecolor{tblco}   {rgb}{0.970,0.970,1.000}
\definecolor{tblce}   {rgb}{0.930,0.930,1.000}
\definecolor{tblunit} {rgb}{0.929,0.863,0.698}
\definecolor{tblfoot} {gray}{0.90}
\definecolor{ttcol}   {rgb}{0.333,0.039,0.098}
\definecolor{emcol}   {rgb}{0.333,0.039,0.098}
\definecolor{d-blue}  {rgb}{0.000,0.200,0.741}
\definecolor{d-red}   {rgb}{0.850,0.125,0.000}
\definecolor{d-green} {rgb}{0.231,0.333,0.094}
\definecolor{m-blue}  {rgb}{0.000,0.447,0.741}
\definecolor{m-red}   {rgb}{0.850,0.325,0.098}
\definecolor{m-yellow}{rgb}{0.929,0.694,0.125}
\definecolor{m-purple}{rgb}{0.494,0.184,0.556}
\definecolor{m-green} {rgb}{0.466,0.674,0.188}
\definecolor{m-cyan}  {rgb}{0.301,0.745,0.933}
\definecolor{m-brown} {rgb}{0.635,0.078,0.184}

% MATLAB Colours
%================
% Blue      0.000  0.447  0.741      0   114   189    0072bdff
% Red       0.850  0.325  0.098    217    83    25    d95319ff
% Orange    0.929  0.694  0.125    237   177    32    edb120ff
% Purple    0.494  0.184  0.556    126    47   142    7e2f8eff
% Green     0.466  0.674  0.188    119   172    48    77ac30ff
% Cyan      0.301  0.745  0.933     77   190   238    4dbeeeff
% Brown     0.635  0.078  0.184    162    20    47    a2142fff

% Links
\usepackage{bookmark}
\usepackage{hyperref}
\usepackage{url}
\hypersetup{colorlinks=true, citecolor=d-blue, urlcolor=d-blue, linkcolor=m-brown}
\urlstyle{same}

% Tables
\newcommand{\texthh}[1]{\textsc{#1}}
\newcommand{\textun}[1]{\small[\texttt{#1}]}
\renewcommand{\arraystretch}{1.16}
\newcolumntype{d}[1]{D{.}{.}{#1}}
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}

% Figures
%\floatstyle{boxed} 
%\restylefloat{figure}

% Captions
\usepackage[font={color=capcol}]{caption}
\captionsetup[table]{labelfont=sc,skip=8pt}
\captionsetup[figure]{labelfont=sc}

% Text
\renewcommand{\rmdefault}{ptm} % Times
% \renewcommand{\sfdefault}{sb}
% \renewcommand{\ttdefault}{sourcecodepro}
\renewcommand{\texttt}[1]{\textcolor{ttcol}{\small\ttfamily #1}}
\renewcommand{\emph}[1]{\textcolor{emcol}{\slshape #1}}

% TOC
\renewcommand\cftpartfont{\sffamily\large}
\renewcommand\cftpartpagefont{\mdseries}
\renewcommand\cftchapfont{\mdseries}
\renewcommand\cftchappagefont{\mdseries}
\renewcommand\cfttoctitlefont{\huge\sffamily}
%\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}

% ================================================================================================================================ %

% Custom Commands
%*****************

% Text
\newcommand{\eq}[1]{Eq. \ref{#1}}
\newcommand{\fig}[1]{Fig. \ref{#1}}
\newcommand{\tbl}[1]{Table \ref{#1}}
\newcommand{\ts}[1]{\textsuperscript{#1}}
\newcommand{\dash}{\textendash~}
\newcommand{\celsius}{\,^{\circ}\mathrm{C}}
\newcommand{\etal}{\textit{et~al.}}

% Math Commands
\newcommand{\unit}[1]{\,\mathrm{#1}}
\newcommand{\funit}[2]{\,\nicefrac{\mathrm{#1}}{\mathrm{#2}}}
\newcommand{\mexp}[1]{\mathrm{e}^{#1}}
\newcommand{\nexp}[1]{\times 10^{#1}}
\newcommand{\deriv}{\mathrm{d}}
%\newcommand{\ln}{\mathrm{ln}}

% Values
\newcommand{\emitN}[0]{\epsilon_{\mathrm{N}}}
\newcommand{\emitg}[0]{\epsilon_{\mathrm{g}}}
\newcommand{\gammar}[0]{\gamma_{\mathrm{r}}}
\newcommand{\betar}[0]{\beta_{\mathrm{r}}}

% Hyphenation
\hyphenation{wave-length}
\hyphenation{Swit-zer-land}
\hyphenation{de-fo-cus-ing}
\hyphenation{de-cel-er-at-ing}

% ================================================================================================================================ %

% Page Layout
%*************

% Plain Page Numbering
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[LE,RO]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
}

% Header style for numbered chapters
\newcommand{\defaulthead}{
    \fancyhead[LE]{\nouppercase{\scshape\leftmark}}
    \fancyhead[RO]{\nouppercase{\scshape\rightmark}}
}

% Custom heading for unnumbered chapters
\newcommand{\simplehead}[1]{
    \fancyhead[LE]{\nouppercase{\scshape #1}}
    \fancyhead[RO]{\nouppercase{\scshape #1}}
}

\pagestyle{fancy}

% Page Header
\renewcommand{\chaptermark}[1]{\markboth{\thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}{}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0pt}

\fancyhf{}
\defaulthead
\headheight 15pt
\fancyfoot[LE,RO]{\thepage}

% Parts
\titleformat{\part}[block]{}{}{}{\centering\fontsize{40}{50}\sffamily\scshape}

% Numbered Chapters
\titlespacing*{\chapter}{0mm}{10mm}{20mm}
\titleformat{\chapter}[hang]{\fontsize{60}{70}\sffamily}{\textcolor{chapter}\thechapter}{8mm}{\Huge\sffamily}

% Sections
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\titleformat{\section}{\Large\sffamily\mdseries}{\thesection}{2mm}{}
\titleformat{\subsection}{\large\sffamily\mdseries}{\thesubsection}{2mm}{}
\titleformat{\subsubsection}{\normalsize\sffamily\mdseries}{\thesubsubsection}{2mm}{}

% ================================================================================================================================ %

% Main Document
%***************

\begin{document}

% Front Matters

\frontmatter
    \input{includes/incFrontPage}

    \cleardoublepage
    \pdfbookmark{Abstract}{Abstract}
    \input{includes/incAbstract}

    \cleardoublepage
    \pdfbookmark{Acknowledgements}{Acknowledgements}
    \input{includes/incAcknowledgements}

    \tocloftpagestyle{plain}
    \cleardoublepage
    \pdfbookmark{\contentsname}{Contents}
    \microtypesetup{protrusion=false}
    \tableofcontents
    \microtypesetup{protrusion=true}
    \cleardoublepage

% Main Matters

\pagestyle{fancy}

\mainmatter
    \phantomsection
    \addcontentsline{toc}{chapter}{Preface}
    \input{includes/incPreface}
    \input{chapters/chIntroduction}
    \input{chapters/chWakefield}
    \input{chapters/chSimulations}
    \input{chapters/chDataAcquisition}
    \input{chapters/chSummary}

% Formatting for Appendices and Publications
\titleformat{\chapter}[display]%
    {\Large\sffamily\scshape}%
    {\textcolor{appendix}\chaptertitlename\ \textcolor{appendix}\thechapter}%
    {2mm}%
    {\Huge\sffamily\upshape}

\addtocontents{toc}{\cftpagenumbersoff{part}}

% Publications

\cleardoublepage
\bookmarksetup{startatroot}
\phantomsection
\part*{Publications}
\label{A:Pub}

\pagestyle{plain}
\renewcommand{\appendixtocname}{Publications}
\renewcommand{\appendixname}{Publication}

\appendix
    \setcounter{chapter}{0}
    \renewcommand{\thechapter}{\Roman{chapter}}
    \renewcommand{\theHchapter}{\Roman{chapter}}
    \input{includes/incIPAC15}
    \includepdf[pages=1-last,openright,scale=0.95,pagecommand={}]{files/IPAC15-WEPWA026.pdf}
    \input{includes/incNAPAC16}
    \includepdf[pages=1-last,openright,scale=0.95,pagecommand={}]{files/NAPAC16-TUA4CO03.pdf}
    \input{includes/incIPAC17}
    \includepdf[pages=1-last,openright,scale=0.95,pagecommand={}]{files/IPAC17-TUPIK061.pdf}
    \input{includes/incPeerRev17}
    \includepdf[pages=1-last,openright,scale=0.95,pagecommand={}]{files/BeamLoading17.pdf}

% Appendices

\cleardoublepage
\bookmarksetup{startatroot}
\phantomsection
\part*{Appendices}
\label{A:App}

\pagestyle{fancy}
\renewcommand{\appendixtocname}{Appendices}
\renewcommand{\appendixname}{Appendix}
\renewcommand{\headrulewidth}{0.5pt}
\defaulthead

\appendix
    \setcounter{chapter}{0}
    \renewcommand{\thechapter}{\Alph{chapter}}
    \renewcommand{\theHchapter}{\Alph{chapter}}
    \input{appendices/apxPIC}
    % \input{appendices/apxAnalysis}
    \input{appendices/apxTools}

% Back Matters

\backmatter

% Revert to standard italics for Bibliography
\renewcommand{\emph}[1]{\textit{#1}}

\bookmarksetup{startatroot}
\cleardoublepage
\phantomsection
\addcontentsline{toc}{chapter}{Bibliography}
\bibliography{Bibliography,Additional}
\null

\phantomsection
\bookmarksetup{startatroot}
\pdfbookmark{End}{EndOfDoc}
\vspace*{\fill}
\footnotesize
\noindent Document compiled on \today~at~\currenttime
\newline
\pdftexbanner

\end{document}

% ================================================================================================================================ %
