%
%    PhD Thesis
% ~~~~~~~~~~~~~~~~~
%  Master Document
%

\documentclass[twoside,openright,12pt]{book}

% ================================================================================================ %

% Main Packages
%***************

% Main
\usepackage[utf8]{inputenc}
\usepackage[UKenglish]{babel}
\usepackage[T1]{fontenc}

% Math
\usepackage{nicefrac}
%\usepackage{xfrac}
\usepackage{amsmath}
\usepackage{amssymb}

% Bibliography
% \usepackage[super,numbers,sort&compress]{natbib}
\usepackage[numbers,sort&compress]{natbib}
\bibliographystyle{PhD}                   % Custom citation style PhD.bst
\usepackage{doi}                          % Makes DOIs clickable

% Layout
\usepackage[a4paper]{geometry}            % Page geometry
\usepackage{emptypage}                    % Prevents page numbers on empty pages
\usepackage{setspace}                     % Line spacing
\usepackage{titlesec}                     % Alternative section titles
\usepackage{fancyhdr}                     % Changing headers and footers
\usepackage{tocloft}                      % For modifying the Table of Contents
\usepackage{hanging}                      % Used for indented paragraphs
\usepackage{appendix}                     % Added functionality for appendices
\usepackage{enumerate}                    % Allows for roman numbered lists

% Fonts
\usepackage[garamondx,expert]{mathdesign} % Adds additional math symbols
\usepackage[scaled]{raleway}              % Raleway font for titles
\usepackage{textcomp}                     % Adds additional text symbols
\usepackage{tgtermes}                     % TEX Gyre Termes font

% Content
\usepackage{pdfpages}                     % Include PDF files
\usepackage{datetime}                     % Used for the last page timestamp

% Disabled
% \usepackage{latexsym}
% \usepackage{cite}
% \usepackage{graphicx}
% \usepackage{float}
% \usepackage{listings}
% \usepackage{simplewick}

% ================================================================================================ %

% Document Layout
%*****************

\geometry{twoside,margin=2.5cm}
\renewcommand{\rmdefault}{ptm}
\renewcommand{\sfdefault}{phv}
\renewcommand{\ttdefault}{pcr}
\AtBeginDocument{\parskip=0pt plus 2.5pt\relax\setstretch{1.1}}

% Fix section numbering bug in Titlesec
\usepackage{etoolbox}
\makeatletter
\patchcmd{\ttlh@hang}{\parindent\z@}{\parindent\z@\leavevmode}{}{}
\patchcmd{\ttlh@hang}{\noindent}{}{}{}
\makeatother

% Colours
\usepackage{color}
\definecolor{chapter} {gray}{0.60}
\definecolor{appendix}{gray}{0.50}
\definecolor{capcol}  {gray}{0.25}
\definecolor{d-blue}  {rgb}{0.000,0.200,0.741}
\definecolor{d-red}   {rgb}{0.850,0.125,0.000}
\definecolor{m-blue}  {rgb}{0.000,0.447,0.741}
\definecolor{m-red}   {rgb}{0.850,0.325,0.098}
\definecolor{m-yellow}{rgb}{0.929,0.694,0.125}
\definecolor{m-purple}{rgb}{0.494,0.184,0.556}
\definecolor{m-green} {rgb}{0.466,0.674,0.188}
\definecolor{m-cyan}  {rgb}{0.301,0.745,0.933}
\definecolor{m-brown} {rgb}{0.635,0.078,0.184}

% MATLAB Colours
%================
% Blue      0.000  0.447  0.741      0   114   189    0072bdff
% Red       0.850  0.325  0.098    217    83    25    d95319ff
% Orange    0.929  0.694  0.125    237   177    32    edb120ff
% Purple    0.494  0.184  0.556    126    47   142    7e2f8eff
% Green     0.466  0.674  0.188    119   172    48    77ac30ff
% Cyan      0.301  0.745  0.933     77   190   238
% Brown     0.635  0.078  0.184    162    20    47

% Captions
\usepackage[font={color=capcol}]{caption} 
\captionsetup[table]{skip=8pt}

% Links
\usepackage{bookmark}
\usepackage{hyperref}
\usepackage{url}
\hypersetup{colorlinks=true, citecolor=d-blue, urlcolor=d-blue, linkcolor=d-red}
\urlstyle{same}

% TOC
\renewcommand\cftpartfont{\sffamily\large}
\renewcommand\cftpartpagefont{\mdseries}
\renewcommand\cftchapfont{\mdseries}
\renewcommand\cftchappagefont{\mdseries}
\renewcommand\cfttoctitlefont{\huge\sffamily}
%\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}

% ================================================================================================ %

% Custom Commands
%*****************

% Hyphenation
\hyphenation{wave-length}

% Text
\newcommand{\eq}[1]{Eq. \ref{#1}}
\newcommand{\fig}[1]{Fig. \ref{#1}}
\newcommand{\tbl}[1]{Table \ref{#1}}
\newcommand{\ts}[1]{\textsuperscript{#1}}
\newcommand{\dash}{\textendash~}

% Math Commands
\newcommand{\unit}[1]{\,\mathrm{#1}}
\newcommand{\funit}[2]{\,\nicefrac{\mathrm{#1}}{\mathrm{#2}}}
\newcommand{\mexp}[1]{\mathrm{e}^{#1}}
\newcommand{\nexp}[1]{\times 10^{#1}}
\newcommand{\deriv}[1]{\;\mathrm{d}#1}

% Values
\newcommand{\emitN}[0]{\epsilon_{\mathrm{N}}}
\newcommand{\emitg}[0]{\epsilon_{\mathrm{g}}}
\newcommand{\gammar}[0]{\gamma_{\mathrm{r}}}
\newcommand{\betar}[0]{\beta_{\mathrm{r}}}

% ================================================================================================ %

% Page Layout
%*************

% Plain Page Numbering
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[LE,RO]{\thepage}
}

% Header style for numbered chapters
\newcommand{\defaulthead}{
    \fancyhead[LE]{\nouppercase{\itshape\leftmark}}
    \fancyhead[RO]{\nouppercase{\itshape\rightmark}}
}

% Custom heading for unnumbered chapters
\newcommand{\simplehead}[1]{
    \fancyhead[LE]{\nouppercase{\itshape #1}}
    \fancyhead[RO]{\nouppercase{\itshape #1}}
}

\pagestyle{fancy}

% Page Header
\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter\ --\ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}{}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

\fancyhf{}
\defaulthead
\headheight 15pt
\fancyfoot[LE,RO]{\thepage}

% Parts
\titleformat{\part}[block]{}{}{}{\centering\fontsize{40}{50}\sffamily}

% Numbered Chapters
\titlespacing*{\chapter}{0mm}{10mm}{20mm}
\titleformat{\chapter}[hang]{\fontsize{60}{70}\sffamily}{\textcolor{chapter}\thechapter}{8mm}{\huge\sffamily}

% Sections
\titleformat{\section}{\large\sffamily}{\thesection}{2mm}{\large}
\titleformat{\subsection}{\normalsize\sffamily}{\thesubsection}{2mm}{}

% ================================================================================================ %

% Main Document
%***************

\begin{document}

% Front Matters

\frontmatter
    \input{includes/incFrontPage}

    \cleardoublepage
    \pdfbookmark{Abstract}{Abstract}
    \input{includes/incAbstract}

    \cleardoublepage
    \pdfbookmark{Acknowledgements}{Acknowledgements}
    \input{includes/incAcknowledgements}

    \tocloftpagestyle{plain}
    \cleardoublepage
    \pdfbookmark{\contentsname}{Contents}
    \tableofcontents
    \cleardoublepage

% Main Matters

\pagestyle{fancy}

\mainmatter
    \phantomsection
    \addcontentsline{toc}{chapter}{Preface}
    \input{includes/incPreface}
    \input{chapters/chIntroduction}
    \input{chapters/chWakefield}
    \input{chapters/chSimulations}
    \input{chapters/chDataAcquisition}
    \input{chapters/chSummary}

% Formatting for Appendices and Publications
\titleformat{\chapter}[display]%
    {\Large\sffamily}%
    {\textcolor{appendix}\chaptertitlename\ \textcolor{appendix}\thechapter}%
    {8mm}%
    {\Large\sffamily}

\addtocontents{toc}{\cftpagenumbersoff{part}}

% Publications

\cleardoublepage
\bookmarksetup{startatroot}
\phantomsection
\part*{Publications}
\label{A:Pub}

\renewcommand\appendixtocname{Publications}
\renewcommand\appendixname{Publication}
\pagestyle{plain}

\appendix
    \setcounter{chapter}{0}
    \renewcommand{\thechapter}{\Roman{chapter}}
    \renewcommand{\theHchapter}{\Roman{chapter}}
    \input{includes/incIPAC15}
    \includepdf[pages=1-last,openright,scale=0.95,pagecommand={}]{files/IPAC15-WEPWA026.pdf}
    \input{includes/incNAPAC16}
    \includepdf[pages=1-last,openright,scale=0.95,pagecommand={}]{files/NAPAC16-TUA4CO03.pdf}
    \input{includes/incIPAC17}
    \includepdf[pages=1-last,openright,scale=0.95,pagecommand={}]{files/IPAC17-TUPIK061.pdf}
    \input{includes/incPeerRev17}
    \includepdf[pages=1-last,openright,scale=0.95,pagecommand={}]{files/BeamLoading17.pdf}

% Appendices

\cleardoublepage
\bookmarksetup{startatroot}
\phantomsection
\part*{Appendices}
\label{A:App}

\renewcommand\appendixtocname{Appendices}
\renewcommand\appendixname{Appendix}

\appendix
    \setcounter{chapter}{0}
    \renewcommand{\thechapter}{\Alph{chapter}}
    \renewcommand{\theHchapter}{\Alph{chapter}}
    \input{appendices/apxPIC}
    \input{appendices/apxAnalysis}

% Back Matters

\backmatter
\bookmarksetup{startatroot}
\cleardoublepage
\phantomsection
\addcontentsline{toc}{chapter}{Bibliography}
\bibliography{Bibliography,Additional}
\null

\phantomsection
\bookmarksetup{startatroot}
\pdfbookmark{End}{EndOfDoc}
\vspace*{\fill}
\footnotesize
\noindent Document compiled on \today~at~\currenttime
\newline
\pdftexbanner

\end{document}

% ================================================================================================ %
