%
%  Simulations
% =============
%

\chapter{Simulations}
\label{Ch:Sim}

The work presented in this thesis has been done using simulations with two particle-in-cell (PIC) codes; OSIRIS \cite{fonseca:2002} and QuickPIC \cite{an:2013, huang:2006}. OSIRIS is a proprietary full PIC code available in 1, 2 and 3 dimensions, with a choice between cartesian and cylindrical coordinates. QuickPIC is a quasi-static 3D PIC code. In this work the open source version of QuickPIC has been used \cite{add:quickpic:web}. For a more detailed description on PIC codes, see Appendix \ref{Apx:PIC}.

Although PIC codes use macro particles, that is, simulated particles represent more than one physical beam or plasma particle, these codes require a lot of CPU power. This is especially true when running in 3D. The preliminary studies presented in Publications \ref{Pub:IPAC15} and \ref{Pub:NAPAC16} were done using OSIRIS with 2D cylindrical coordinates. The main study, Publication \ref{Pub:BL17}, was done using QuickPIC in 3D. In order to perform the detailed parameter scans needed for these studies, the drive beam and accelerating structure had to be scaled down into a more manageable size than the full SPS proton beam. This section will outline the simulation environment chosen for these studies, and the reasons behind these.

% ================================================================================================ %
\section{Evolution of the Proton Beam}
\label{Sim:PBeam}

An initial set of simulations were run to study the evolution of the self-modulation instability in the SPS proton beam. These simulations assumed the plasma was ionised at the centre of the proton beam, so only the back half of the beam was actually simulated. The beam profile function took the form:
\begin{equation}
    Q_{pb} = A_{q}\pi \int_{0}^{L} \int_{0}^{R} 1 + \cos\left(\xi\frac{\pi}{L}\right) \exp\left(-\frac{r^{2}}{2\sigma_{r}^{2}}\right) r \deriv{r}\deriv{\xi}, \label{EQ:SPS-Profile}
\end{equation}
where $L = 2.5\sigma_{z,pb} = 30\unit{cm}$ is the length of half an SPS proton bunch, $R$ is the radius of the simulation box, and $A_{q}$ is a charge scaling factor to match the SPS bunch charge.

% ================================================================================================ %

\subsection{Studies with Pre-modulated Beam}
\label{Sim:PBPreMod}

Text

% ================================================================================================ %

\subsection{Studies with Single Drive Bunch}
\label{Sim:PBSingle}

Text

% ================================================================================================ %

\section{Beam Loading and Energy Spread}
\label{Sim:BLoad}

Text

% ================================================================================================ %

\subsection{The Linear Regime}
\label{Sim:Lin}

The ideal case from Tzoufras 2008.

% ================================================================================================ %

\subsection{The Quasi-linear Regime}
\label{Sim:QLin}

Text

% ================================================================================================ %

\section{Emittance Evolution}
\label{Sim:Emitt}

Emittance is preserved in the linear regime

% ================================================================================================ %

\subsection{Beam Matching}
\label{Sim:Match}

In the non-linear $n_{b} > n_{0}$ case where an ion column is formed, the focusing force it produces will cause a pinching effect on the beam. The beam itself, assuming $\emitN > 0$, will cause the beam to try to expand. There exists a beam radius where the focusing force and the beam's tendency to expand are in equilibrium. For a highly relativistic beam, $\gammar \gg 1$, the equilibrium radius is given by \cite{krall:1995}
\begin{equation}
    R_{\mathrm{eq}} = \left( 8 \frac{\emitN^2}{\gammar} \frac{c^2}{\omega_{p}^2} \right)^{1/4}. \label{EQ:Sim:Req}
\end{equation}

Equation \ref{EQ:Sim:Req} follows from the general enevolpe equation \cite{lee:1976} under the assumption that the beam enters the plasma at focus (i.e. $\deriv{\sigma_{r}}/\deriv{z} = 0$), does not diverge significantly from a Gaussian transverse density profile, and that the focusing force is linear \cite{krall:1995} \dash the latter being the case in the blow-out regime.

% ================================================================================================ %

\subsection{The Quasi-linear + Non-Linear Case}
\label{Sim:QLinNonLin}

An electron beam matched to the typical AWAKE plasma density will be, as discussed in \ref{Sim:Match}, very narrow. At a typical normalised emittance of $2.0\unit{\mu m}$ the beam is $5.25\unit{\mu m}$. Even at low beam charge and at the upper limit in terms of beam length, the wakefields of such a beam will quickly reach the non-linear regime. In the base case used in the beam loading study included in Publication \ref{Pub:BL17} \cite{berglyd_olsen:2017a} the peak density of the beam $n_b/n_0 > 35$, well beyond the saturation level of the bubble that occurs when $n_b/n_0 > 10$ \cite{lu:2005}.

The implication here is that there is an additional benefitial effect of loading the accelerating field with as much charge as it will allow without overloading it. The resulting non-linear wake driven by the head of the beam, which will see emittance growth due to the quasi-linear conditions of the proton wake, ensures that the rest of the beam sees a strong focusing force preventing further emittance growth. As the electron beam gains energy, its transverse size will decrease as its emittance is preserved as $\sigma_{r} = \sqrt{\emitN\beta}$ \cite{wille:2001}.

% ================================================================================================ %

\section{Optimising the Witness Beam}
\label{Sim:Opt}

Bringing it all together.

% ================================================================================================ %
